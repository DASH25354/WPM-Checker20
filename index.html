<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WPM Quiz with Audio</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  html, body {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body { 
    font-family: Arial, sans-serif; 
    padding: 30px; 
    font-size: 1.5em;
    padding-top: 40px;
    box-sizing: border-box;
  }

  h2, h3 {
    font-size: 1.5em;
  }

  #text { 
    border: 1px solid #ccc; 
    padding: 30px; 
    margin-bottom: 2.8em; /* 英文下の余白2行分 */
    background: #f9f9f9; 
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .audio-wrapper {
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    margin-bottom: 2.8em; /* プレイヤー下の余白2行分 */
  }
  audio {
    width: 100%;
    max-width: 800px;
    display: block;
    margin: 0 auto;
    background: #fff;
    box-sizing: border-box;
    z-index: 1000;
    padding: 10px 0;
    border: none;
  }

  button {
    font-size: 1.5em; 
    padding: 15px 30px;
    margin: 10px;
  }

  input[type="checkbox"] {
    transform: scale(1.5);
    margin-right: 10px;
  }

  #controls { 
    margin: 0 0 30px 0;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }
  #questions { 
    margin-top: 30px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .question-option {
    display: block;
    margin-bottom: 18px;
  }

  #result {
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    margin-top: 30px;
  }

  /* --- モバイル用スタイル --- */
  @media (max-width: 600px) {
    body { 
      padding-top: 20px;
      font-size: 1.1em;
      padding-left: 5px;
      padding-right: 5px;
    }
    #text, #controls, #questions, #result, .audio-wrapper {
      padding: 0 2vw;
      max-width: 100vw;
      margin-left: 0;
      margin-right: 0;
    }
    #text { padding: 15px 2vw; }
    .audio-wrapper { margin-bottom: 2.8em; }
    audio {
      width: 100vw;
      max-width: 100vw;
      margin: 0 0 0 0;
      padding: 0;
    }
    button {
      font-size: 1em;
      padding: 10px 16px;
    }
    input[type="checkbox"] {
      transform: scale(1.2);
    }
    .question-option {
      margin-bottom: 16px;
    }
  }
</style>
</head>
<body>

<h2 style="max-width:800px;margin:0 auto 30px auto;">Three-minute Training</h2>

<!-- テキスト -->
<div id="text">
【20】Machikane Festival is a big event at Osaka University. Long ago, there was a sports and culture festival. This is its start. Osaka University has two festivals: one in spring and one in autumn. Machikane in autumn is bigger and longer. Many people come every year. This year, the theme is “EXPOSION.” It mixes “EXPO” and “EXPLOSION.” It means student ideas are big and strong for three days. There are over 200 plans by clubs and student groups. You can walk and try food at small stands. You can see and buy art and other works. You can watch music and dance on the stage. Please find your favorite plan. Visitors can vote for popular plans. There are also events by schools and labs. You can see research and learn. It is a good chance to know Osaka University. Students are very active. You can also see daily life: the shop is open in the day. If exams are near, please come and relax your mind. It is easy to join.</div>

<!-- 音声再生（英文の下、ボタンの上） -->
<div class="audio-wrapper">
  <audio controls>
    <source src="20.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
</div>

<div id="controls">
  <button onclick="startReading()">▶ Start</button>
  <button onclick="finishReading()">⏹ Finish</button>
</div>

<div id="questions">
  <h3>Quiz</h3>
  <label>Select all options below that match the content of the passage.</label></span>
  <span class="question-option"><input type="checkbox" class="q1" value="a"> It is a large, historic autumn festival at Osaka University with many student-led events and a special theme. 
</span>
  <span class="question-option"><input type="checkbox" class="q1" value="b"> The festival has only food stalls and no stage performances.</span>
  <span class="question-option"><input type="checkbox" class="q1" value="c"> It is a one-day event held only in spring.</span>
  <span class="question-option"><input type="checkbox" class="q1" value="d"> Visitors can explore research, vote on projects, and experience campus life during the three-day event.  </span>
</div>

<div id="result"></div>

<script>
let startTime;
let wordCount = 0;

function startReading() {
  const text = document.getElementById("text").innerText.trim();
  wordCount = text.split(/\s+/).length;
  startTime = Date.now();
  document.getElementById("result").innerText = "Reading started...";
}

function finishReading() {
  if (!startTime) return alert("Please start reading first!");
  const elapsedSec = (Date.now() - startTime) / 1000;

  // 正解選択肢: a, d
  const correctAnswers = ["a", "d"];
  const checked = Array.from(document.querySelectorAll(".q1:checked")).map(el => el.value);
  const numCorrect = checked.filter(val => correctAnswers.includes(val)).length;
  const numIncorrect = checked.filter(val => !correctAnswers.includes(val)).length;
  const totalCorrect = correctAnswers.length;

  // 指定されたAccuracy計算
  let accuracy = ((numCorrect - numIncorrect) / totalCorrect) * 100;
  if (accuracy < 0) {
    accuracy = 0;
  }

  const rawWPM = (wordCount / elapsedSec) * 60;
  const finalWPM = Math.round(rawWPM * (accuracy / 100));

  document.getElementById("result").innerHTML =
    `Time: ${elapsedSec.toFixed(1)} sec<br>` +
    `Raw WPM: ${rawWPM.toFixed(1)}<br>` +
    `Accuracy: ${accuracy.toFixed(0)}%<br>` +
    `Final WPM (accuracy applied): ${finalWPM}`;
}
</script>

</body>
</html>










